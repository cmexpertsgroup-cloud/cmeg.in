<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CM Experts Group – Payment Admin</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
:root{
  --red:#B71C1C;
  --grey:#444;
  --bg:#f4f4f4;
}
body{
  font-family:Roboto, sans-serif;
  background:var(--bg);
  margin:0;
  padding:20px;
}
.container{
  max-width:620px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 6px 14px rgba(0,0,0,.1);
}
.header{
  text-align:center;
  border-bottom:1px solid #eee;
  padding-bottom:12px;
  margin-bottom:15px;
}
.header h2{margin:5px 0;color:var(--grey)}
.header h4{margin:0;color:var(--red)}

.upi-box{
  background:#fdecec;
  padding:10px;
  border-radius:8px;
  margin-bottom:15px;
}
.upi-box select{
  width:100%;
  padding:8px;
  margin-top:6px;
}

.client-card{
  border-bottom:1px solid #eee;
  padding:14px 0;
  display:flex;
  justify-content:space-between;
}
.amount{
  background:var(--red);
  color:#fff;
  padding:4px 8px;
  border-radius:4px;
  font-size:14px;
  display:inline-block;
  margin-top:4px;
}
.phone{
  font-size:11px;
  color:#777;
}
.btn-wa{
  background:#25D366;
  color:#fff;
  border:none;
  padding:9px 14px;
  border-radius:6px;
  cursor:pointer;
  font-size:13px;
}
.btn-qr{
  margin-top:6px;
  padding:6px;
  font-size:12px;
  cursor:pointer;
}
.qr-box{
  display:none;
  margin-top:6px;
}
</style>
</head>

<body>

<div class="container">
  <div class="header">
    <h2>CM Experts Group</h2>
    <h4>PAYMENT PORTAL – ADMIN</h4>
  </div>

  <div class="upi-box">
    <strong>Select UPI</strong>
    <select id="upiSelect" onchange="renderList()">
      <option value="cmtaxexperts@ybl">cmtaxexperts@ybl (Tax)</option>
      <option value="accountree1@fdl">accountree1@fdl (Accounting)</option>
    </select>
  </div>

  <div id="loading">Loading data…</div>
  <div id="list"></div>
</div>

<script>
/* ===== YOUR APPS SCRIPT URL ===== */
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyiBS9Xy9t3qvTKSipXRXLRJBmQJ9SeTEGZiyBh21eDRgiDobRvsVXGb1f7At6QuHv1/exec";

let dataRows = [];

fetch(WEB_APP_URL + "?t=" + Date.now())
.then(r=>r.json())
.then(d=>{
  document.getElementById("loading").style.display="none";
  dataRows = d;
  renderList();
})
.catch(()=>{
  document.getElementById("loading").innerHTML="Error loading data";
});

function renderList(){
  const box=document.getElementById("list");
  const upi=document.getElementById("upiSelect").value;
  box.innerHTML="";

  if(!dataRows.length){
    box.innerHTML="<center>No pending payments</center>";
    return;
  }

  dataRows.forEach(r=>{
    const gstRent = Number(r["GST On Rent"] || r.gst_on_rent || 0);
    const fee     = Number(r["Fee"] || r.fee || 0);
    const gstEpf  = Number(r["GST & EPF"] || r.gst_epf || 0);
    let total     = Number(r.Total || r.total || gstRent + fee + gstEpf);

    /* ===== MESSAGE ===== */
    let msg =
`*PAYMENT DUE*

Hello *${r.client}*,

Invoice details:
${gstRent>0?`• GST on Rent : Rs.${gstRent}\n`:""}${fee>0?`• Service Fee : Rs.${fee}\n`:""}${gstEpf>0?`• GST & EPF : Rs.${gstEpf}\n`:""}
*Total Payable Rs.${total}/-*

Pay using link:
https://cmeg.in/pay?client=${encodeURIComponent(r.client)}&amt=${total}&upi=${encodeURIComponent(upi)}

UPI IDs:
• cmtaxexperts@ybl (Tax)
• accountree1@fdl (Accounting)`;

    let phone = (r.phone||"").replace(/\D/g,"");
    let wa = phone.length>=10
      ? `https://wa.me/91${phone.slice(-10)}?text=${encodeURIComponent(msg)}`
      : `https://wa.me/?text=${encode
